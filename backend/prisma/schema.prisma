generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["lovable", "public"]
}

// Tabela 1: Login de Usuários
model AppsUsuarios {
  id           String    @id @default(uuid())
  nome         String?
  email        String?
  login        String?
  senha        String? // Hash bcrypt
  cargo        String?
  ci           Boolean?  @default(false)
  pfo          Boolean?  @default(false)
  comercial    Boolean?  @default(false)
  ronda        Boolean?  @default(false)
  reuniao      Boolean?  @default(false) // Permissão reuniões
  data_criacao DateTime? @default(now()) @db.Date
  area         String?   @db.Text

  @@map("apps_usuarios")
  @@schema("lovable")
}

// Tabela 2: Reuniões de Governança
model EppReunioesGovernanca {
  id                       String    @id @default(uuid())
  conference_id            String    @unique // PK funcional
  data_reuniao             DateTime? @db.Date
  hora_inicio              String?
  hora_fim                 String?
  responsavel              String?
  anotacao                 String?
  transcricao              String?
  link_anotacao            String?
  link_transcricao         String?
  link_gravacao            String?
  ata                      String?   @db.Text
  ata_pdf_link             String?
  ata_link_download        String?
  titulo_reuniao           String?
  local_meio               String?
  participantes_nomes      String?
  participantes_areas      String?
  objetivo_reuniao         String?   @db.Text
  itens_pauta_titulos      String?
  itens_pauta_completo     String?   @db.Text
  deliberacoes_titulos     String?
  deliberacoes_discussoes  String?   @db.Text
  deliberacoes_decisoes    String?   @db.Text
  acoes_lista              String?   @db.Text
  acoes_responsaveis       String?   @db.Text
  proximas_etapas          String?   @db.Text
  resumo_executivo         String?   @db.Text

  @@map("epp_reunioes_governanca")
  @@schema("public")
}

// Tabela 3: Rastreamento de Artefatos de Conferência (para ambiente serverless)
model ConferenceArtifactTracking {
  id                 String    @id @default(uuid())
  conference_id      String    @unique // conferenceRecords/xxx
  user_email         String? // Email do organizador
  has_recording      Boolean   @default(false)
  has_transcript     Boolean   @default(false)
  has_smart_note     Boolean   @default(false)
  recording_name     String?
  transcript_name    String?
  smart_note_name    String?
  recording_url      String? // URL direta extraída do evento Pub/Sub (exportUri)
  transcript_url     String?
  smart_note_url     String?
  first_event_at     DateTime  @default(now())
  last_event_at      DateTime  @default(now())
  timeout_at         DateTime? // Timeout para processar artefatos parciais (null enquanto no_artifact)
  status             String    @default("no_artifact") // no_artifact, waiting, processing, complete, partial_complete, error, ignored
  processed_at       DateTime?
  created_at         DateTime  @default(now())
  updated_at         DateTime  @updatedAt

  @@map("epp_conference_artifact_tracking")
  @@schema("lovable")
}
